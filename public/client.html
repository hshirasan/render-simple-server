<!-- Filename: client_panel.html -->
<!-- Version: client_v2.7.1 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Panel</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
        }
        img {
            position: absolute;
            top: 50px;
            left: 50px;
            display: none;
        }
    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <img id="qr-code" src="qr-code.png" width="100" height="100">
    <img id="png-image" src="image.png" width="100" height="100" style="left: 160px;">
    <script>
        const socket = io();
        let blinkInterval;

        function applySettings({ color, blinkPattern, onTime, offTime }) {
            const body = document.body;
            const qrCode = document.getElementById('qr-code');
            const pngImage = document.getElementById('png-image');

            clearInterval(blinkInterval);

            if (blinkPattern === 'always') {
                body.style.backgroundColor = color;
                const showImages = (color === 'rgb(0, 0, 0)');
                qrCode.style.display = showImages ? 'block' : 'none';
                pngImage.style.display = showImages ? 'block' : 'none';
            } else if (blinkPattern === 'fade') {
                let opacity = 0;
                let increment = 0.1;
                blinkInterval = setInterval(() => {
                    opacity += increment;
                    if (opacity <= 0 || opacity >= 1) increment = -increment;
                    body.style.backgroundColor = `rgba(${color.match(/\d+/g).join(',')}, ${opacity})`;
                }, onTime / 10);
                qrCode.style.display = 'none';
                pngImage.style.display = 'none';
            } else {
                let isOn = true;
                blinkInterval = setInterval(() => {
                    body.style.backgroundColor = isOn ? color : 'black';
                    isOn = !isOn;
                }, isOn ? onTime : offTime);
                qrCode.style.display = 'none';
                pngImage.style.display = 'none';
            }
        }

        socket.on('update-display', (settings) => {
            console.log('Received settings:', settings);
            applySettings(settings);
        });

        socket.on('heartbeat', (data) => {
            console.log('Heartbeat received', data);
        });

        window.addEventListener('beforeunload', () => {
            socket.close();
        });
    </script>
</body>
</html>
