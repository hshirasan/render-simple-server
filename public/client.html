const socket = io();

let animationInterval;

// サーバーからの設定を受信
socket.on('update-display', (settings) => {
    console.log('Received settings:', settings);

    const { color, blinkPattern, timestamp } = settings;

    // 点滅処理をリセット
    if (animationInterval) {
        clearInterval(animationInterval);
        document.body.style.transition = 'none'; // アニメーションをリセット
        document.body.style.backgroundColor = 'black';
    }

    const offset = Date.now() - timestamp; // サーバーとクライアントのタイムラグ
    const initialDelay = blinkPattern === 'always' ? 0 : (500 - (offset % 500));

    switch (blinkPattern) {
        case 'always':
            // 常時点灯
            document.body.style.backgroundColor = color;
            break;

        case 'blink-100-400':
            animationInterval = setTimeout(() => {
                animationInterval = setInterval(() => {
                    document.body.style.backgroundColor =
                        document.body.style.backgroundColor === 'black' ? color : 'black';
                }, 500);
            }, initialDelay);
            break;

        case 'blink-500-500':
            animationInterval = setTimeout(() => {
                animationInterval = setInterval(() => {
                    document.body.style.backgroundColor =
                        document.body.style.backgroundColor === 'black' ? color : 'black';
                }, 1000);
            }, initialDelay);
            break;

        case 'fade':
            document.body.style.transition = 'background-color 0.5s ease-in-out';
            animationInterval = setTimeout(() => {
                animationInterval = setInterval(() => {
                    document.body.style.backgroundColor =
                        document.body.style.backgroundColor === 'black' ? color : 'black';
                }, 1000);
            }, initialDelay);
            break;

        default:
            console.error('Unknown blink pattern:', blinkPattern);
    }
});
