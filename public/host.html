<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Panel</title>
    <style>
        fieldset {
            margin-bottom: 20px;
        }
        #password-prompt {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f8f9fa;
        }
        #host-panel {
            display: none;
        }
    </style>
</head>
<body>
    <!-- パスワード入力画面 -->
    <div id="password-prompt">
        <h1>Enter Host Password</h1>
        <input type="password" id="password-input" placeholder="Password">
        <button id="password-submit">Submit</button>
        <p id="error-message" style="color: red; display: none;">Invalid password. Please try again.</p>
    </div>

    <!-- ホストパネル -->
    <div id="host-panel">
        <h1>Host Panel</h1>

        <!-- 色選択 -->
        <fieldset>
            <legend>Select Color:</legend>
            <label><input type="radio" name="color" value="null" checked> None</label>
            <label><input type="radio" name="color" value="red"> Red</label>
            <label><input type="radio" name="color" value="yellow"> Yellow</label>
            <label><input type="radio" name="color" value="green"> Green</label>
            <label><input type="radio" name="color" value="blue"> Blue</label>
        </fieldset>

        <!-- 点滅パターン選択 -->
        <fieldset>
            <legend>Select Blink Pattern:</legend>
            <label><input type="radio" name="blink" value="always" checked> Always On</label>
            <label><input type="radio" name="blink" value="pattern1"> Pattern 1 (100ms ON / 400ms OFF)</label>
            <label><input type="radio" name="blink" value="pattern2"> Pattern 2 (250ms ON / 250ms OFF)</label>
            <label><input type="radio" name="blink" value="pattern3"> Pattern 3 (400ms ON / 100ms OFF)</label>
            <label><input type="radio" name="blink" value="fade"> 500ms Fade In / 500ms Fade Out</label>
        </fieldset>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const passwordPrompt = document.getElementById('password-prompt');
        const hostPanel = document.getElementById('host-panel');
        const passwordInput = document.getElementById('password-input');
        const passwordSubmit = document.getElementById('password-submit');
        const errorMessage = document.getElementById('error-message');

        // パスワード送信イベント
        passwordSubmit.addEventListener('click', () => {
            const password = passwordInput.value;

            socket.emit('authenticate-host', password, (response) => {
                if (response.success) {
                    passwordPrompt.style.display = 'none'; // パスワード入力画面を非表示
                    hostPanel.style.display = 'block'; // ホストパネルを表示
                } else {
                    errorMessage.textContent = response.message || 'Invalid password.';
                    errorMessage.style.display = 'block'; // エラーメッセージを表示
                }
            });
        });

        // ホストの設定変更を送信
        const updateSettings = () => {
            const color = document.querySelector('input[name="color"]:checked')?.value;
            const blinkPattern = document.querySelector('input[name="blink"]:checked')?.value;

            let onTime = 250;
            let offTime = 250;

            switch (blinkPattern) {
                case 'pattern1':
                    onTime = 100;
                    offTime = 400;
                    break;
                case 'pattern2':
                    onTime = 250;
                    offTime = 250;
                    break;
                case 'pattern3':
                    onTime = 400;
                    offTime = 100;
                    break;
                case 'fade':
                    // フェードは特殊処理として個別対応
                    socket.emit('update-settings', { color, blinkPattern });
                    return;
            }

            if (color !== 'null' && blinkPattern !== 'null') {
                socket.emit('update-settings', { color, blinkPattern: 'custom', onTime, offTime });
            }
        };

        // ラジオボタンの変更イベント
        document.querySelectorAll('input[type="radio"]').forEach((radio) =>
            radio.addEventListener('change', updateSettings)
        );
    </script>
</body>
</html>
